## 列表和分类
wxml 部分
```html
<template>
  <view>
    <!-- 分类 -->
    <view>
      <view @tap="toggle">{{ currentCategory.name || '话题' }}</view>
      <view hidden="{{ !categoryOpen }} ">
        <repeat for="{{ categories }}" key="id" item="category">
          <view @tap="changeCategory({{ category.id }})">{{ category.name }}</view>
        </repeat>
      </view>
    </view>
    <!-- 列表 -->
    <repeat for="{{ topics }}" key="id" index="index" item="topic">
      <navigator url="/pages/topics/show?id={{ topic.id }}">
        <view>标题：{{ topic.title }}</view>
        <view>日期：{{ topic.updated_at_diff }}</view>
      </navigator>
    </repeat>
    <!-- 没有更多数据 -->
    <view wx:if="{{ noMoreData }}">没有更多数据</view>
  </view>
</template>
```
js 部分
```javascript
import wepy from 'wepy'
import api from '@/utils/api'
import util from '@/utils/util'

export default class List extends wepy.page {
  config = {
    // 启用下拉刷新
    enablePullDownRefresh: true
  }
  data = {
    // 话题数据
    topics: [],
    // 当前分页
    page: 1,
    // 没有更多数据
    noMoreData: false,
    // 分类信息
    categories: [],
    // 是否打开分类列表
    categoryOpen: false,
    // 当前分类
    currentCategory: {}
  }
  computed = {
    currentCategoryId () {
      return this.currentCategory.id || 0
    }
  }
  // 获取话题数据
  async getTopics(page = 1, reset = false) {
    try {
      // 请求话题列表接口
      let topicsResponse = await api.request({
        url: 'topics',
        data: {
          page: page,
          category_id: this.currentCategoryId,
          include: 'user,category'
        }
      })
      // 填充数据
      let topics = topicsResponse.data.data
      topics.forEach(function (topic) {
        topic.updated_at_diff = util.diffForHumans(topic.updated_at)
      })
      this.topics = reset ? topics : this.topics.concat(topics)

      // 根据分页设置是否还有更多数据
      let pagination = topicsResponse.data.meta.pagination
      if (pagination.current_page === pagination.total_pages) {
        this.noMoreData = true
      }

      this.$apply()
    } catch (err) {
      wepy.showModal({
        title: '提示',
        content: '服务器错误，请联系管理员'
      })
    }
  }
  // 获取分类
  async getCategories() {
    // 从缓存中获取分类数据
    let categories = wepy.getStorageSync('categories')

    // 如果没有缓存数据
    if (!categories) {
      try {
        let categoriesResponse = await api.request('categories')
        // 请求成功将数据添加至缓存
        if (categoriesResponse.statusCode === 200) {
          categories = categoriesResponse.data.data
          wepy.setStorageSync('categories', categories)
        }
      } catch (err) {
        wepy.showModal({
          title: '提示',
          content: '服务器错误，请联系管理员'
        })
      }
    }

    this.categories = categories
    this.$apply()
  }
  onLoad() {
    this.getTopics()
    this.getCategories()
  }
  // 下拉刷新
  async onPullDownRefresh() {
    this.page = 1
    await this.getTopics(1, true)
    wepy.stopPullDownRefresh()
  }
  // 触底加载更多
  onReachBottom() {
    // 如果没有更多内容，直接返回
    if (this.noMoreData) {
      return
    }
    this.page = this.page + 1
    this.getTopics(this.page)
  }
  methods = {
    // 开关分类菜单
    toggle () {
      this.categoryOpen = !this.categoryOpen
    },
    // 改变分类
    changeCategory (id = 0) {
      this.currentCategory = id ? this.categories.find(category => category.id === id) : {}
      // 关闭分类菜单
      this.categoryOpen = false
      this.getTopics(1, true)
    }
  }
}
```