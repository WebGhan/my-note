## 编辑用户信息
wxml 部分
```html
<template>
  <form bindsubmit="submit">
    <!-- 编辑头像 -->
    <image src="{{ user.avatar }}" @tap="updateAvatar" />
    <!-- 填写姓名 -->
    <input placeholder="请输入姓名" name="name" value="{{ user.name }}" />
    <view wx:if="{{ errors.name }}">{{ errors.name[0] }}</view>
    <!-- 填写邮箱 -->
    <input placeholder="请输入邮箱" name="email" value="{{ user.email }}" />
    <view wx:if="{{ errors.email }}">{{ errors.email[0] }}</view>
    <!-- 填写简介 -->
    <textarea placeholder="请输入简介" name="introduction" value="{{ user.introduction }}" />
    <view wx:if="{{ errors.introduction }}">{{ errors.introduction[0] }}</view>
    <!-- 提交表单 -->
    <button formType="submit">修改</button>
  </form>
</template>
```
js 部分
```javascript
import wepy from 'wepy'
import api from '@/utils/api'

export default class UserEdit extends wepy.page {
  data = {
    // 用户信息
    user: null,
    // 错误信息
    errors: null,
    // 头像id
    avatarId: 0
  }
  async onShow() {
    // 获取当前用户信息
    this.user = await this.$parent.getCurrentUser()
    this.$apply()
  }
  // 表单提交
  async submit (e) {
    this.errors = null

    try {
      // e.detail.value 为表单提交的数据
      let formData = e.detail.value

      // 当avatarId被设置过之后则增加到 avatar_image_id 中
      if (this.avatarId !== 0) {
        formData.avatar_image_id = this.avatarId
      }

      let editResponse = await api.authRequest({
        url: 'user',
        method: 'PUT',
        data: e.detail.value
      })
      
      // 请求成功，缓存用户数据
      if (editResponse.statusCode === 200) {
        this.user = editResponse.data
        wepy.setStorageSync('user', editResponse.data)
        this.$apply()

        wepy.showToast({
          title: '修改成功',
          icon: 'success',
          duration: 2000
        })
      }

      // 设置报错信息
      if (editResponse.statusCode === 422) {
        this.errors = editResponse.data.errors
        this.$apply()
      }
    } catch (err) {
      console.log(err)
      wepy.showModal({
        title: '提示',
        content: '服务器错误，请联系管理员'
      })
    }
  }
  methods = {
    async updateAvatar () {
      // 选择头像图片
      let image = await wepy.chooseImage({count: 1})

      try {
        // 获取选择的图片
        let avatar = image.tempFilePaths[0]

        // 调用上传图片接口
        let imageResponse = await api.updateFile({
          url: 'images',
          method: 'POST',
          name: 'image',
          formData: {
            type: 'avatar'
          },
          filePath: avatar
        })

        // 上传成功，记录数据
        if (imageResponse.statusCode === 201) {
          // 小程序上传结果没有做 JSON.parse，需要手动处理
          let responseData = JSON.parse(imageResponse.data)
          this.user.avatar = responseData.path
          this.avatarId = responseData.id
          this.$apply()
        }
      } catch (err) {
        console.log(err)
        wepy.showModal({
          title: '提示',
          content: '服务器错误，请联系管理员'
        })
      }
    }
  }
}
```